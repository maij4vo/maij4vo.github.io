<!DOCTYPE html>
<html lang = 'fi'>

<head>
    <meta charset = 'UTF-8' />
    <meta name ='viewport' content = 'width = device-width, initial-scale=1' />
    <title>Joulukalenteri</title>
    <link rel = 'stylesheet' href = 'tyyli.css'>
</head>

<body>
    <canvas id = 'snow-canvas'></canvas>
    <header>
    <h1> Joulukalenteri 2025 </h1>
    </header>

    <main>

    <!-- Tänne joulukuusi (Lisäsin lahjapaketin kuusen juureen) --> 
    <div class = 'kuusi-container'>
        <img src = 'kuusi.png' alt = 'joulukuusi' class = 'kuusi' />
        <img src="tahti.png" alt="Joulutähti" class="tahti" />
      <div class="jouluvalot">
  <!-- Latvarivi 1 (korkeimmalla) -->
  <span class="valo" style="top: 18%; left: 49%;"></span>

  <!-- Latvarivi 2 -->
  <span class="valo" style="top: 23%; left: 46%;"></span>
  <span class="valo" style="top: 23%; left: 52%;"></span>

  <!-- Latvarivi 3 -->
  <span class="valo" style="top: 27%; left: 44%;"></span>
  <span class="valo" style="top: 27%; left: 49%;"></span>
  <span class="valo" style="top: 27%; left: 54%;"></span>

  <!-- Ylin "rivi" -->
  <span class="valo" style="top: 30%; left: 50%;"></span>
  <span class="valo" style="top: 32%; left: 44%;"></span>
  <span class="valo" style="top: 32%; left: 56%;"></span>

  <!-- Toinen rivi -->
  <span class="valo" style="top: 40%; left: 42%;"></span>
  <span class="valo" style="top: 41%; left: 50%;"></span>
  <span class="valo" style="top: 40%; left: 58%;"></span>

  <!-- Kolmas rivi -->
  <span class="valo" style="top: 48%; left: 40%;"></span>
  <span class="valo" style="top: 49%; left: 48%;"></span>
  <span class="valo" style="top: 48%; left: 56%;"></span>
  <span class="valo" style="top: 49%; left: 62%;"></span>

  <!-- Neljäs rivi -->
  <span class="valo" style="top: 57%; left: 38%;"></span>
  <span class="valo" style="top: 58%; left: 46%;"></span>
  <span class="valo" style="top: 58%; left: 54%;"></span>
  <span class="valo" style="top: 57%; left: 62%;"></span>

  <!-- Viides rivi -->
  <span class="valo" style="top: 66%; left: 36%;"></span>
  <span class="valo" style="top: 67%; left: 44%;"></span>
  <span class="valo" style="top: 67%; left: 52%;"></span>
  <span class="valo" style="top: 66%; left: 60%;"></span>

  <!-- Kuudes rivi -->
<span class="valo" style="top: 74%; left: 34%;"></span>
<span class="valo" style="top: 74%; left: 44%;"></span>
<span class="valo" style="top: 75%; left: 54%;"></span>
<span class="valo" style="top: 74%; left: 64%;"></span>

<!-- Seitsemäs rivi -->
<span class="valo" style="top: 82%; left: 32%;"></span>
<span class="valo" style="top: 83%; left: 42%;"></span>
<span class="valo" style="top: 83%; left: 52%;"></span>
<span class="valo" style="top: 82%; left: 62%;"></span>

<!-- Kahdeksas (alin) rivi -->
<span class="valo" style="top: 90%; left: 30%;"></span>
<span class="valo" style="top: 90%; left: 40%;"></span>
<span class="valo" style="top: 90%; left: 50%;"></span>
<span class="valo" style="top: 90%; left: 60%;"></span>
</div>
      
        <!--1--> <img src="Lahjapaketti.png" alt="Lahjapaketti" class="lahjapaketti"
         style="position:absolute; left: 96.6%; bottom: 1px; width:160px; cursor:pointer; z-index:2;"data-koriste="koristepallo1.png">

        <!--2--> <img src="sinipuna.png" alt="Lahjapaketti" class="lahjapaketti"
         style="position:absolute; left: 92.4%; bottom: 1px; width:160px; cursor:pointer; z-index:2;"data-koriste="karkkikeppi.png">

        <!--3--> <img src="Lahjapaketti.png" alt="Lahjapaketti" class="lahjapaketti"
         style="position:absolute; left:88.2%; bottom: 1px; width:160px; cursor:pointer; z-index:1;"data-koriste="kellokoriste.png">

        <!--4--> <img src="valkosini.png" alt="Lahjapaketti" class="lahjapaketti"
         style="position:absolute; left:84%; bottom: 1px; width:160px; cursor:pointer; z-index:2;"data-koriste="karkkikeppi.png">

        <!--5--> <img src="kelttu.png" alt="Lahjapaketti" class="lahjapaketti"
         style="position:absolute; left:79.8%; bottom: 1px; width:160px; cursor:pointer; z-index:2;"data-koriste="pipariukko.png">

        <!--6--> <img src="kelttu.png" alt="Lahjapaketti" class="lahjapaketti"
         style="position:absolute; left:75.6%; bottom: 1px; width:160px; cursor:pointer; z-index:2;"data-koriste="koristepallo1.png">

        <!--7--> <img src="Lahjapaketti.png" alt="Lahjapaketti" class="lahjapaketti"
         style="position:absolute; left:71.4%; bottom: 1px; width:160px; cursor:pointer; z-index:2;"data-koriste="koristepallo1.png">

        <!--8--> <img src="sinipuna.png" alt="Lahjapaketti" class="lahjapaketti"
         style="position:absolute; left: 67.2%; bottom: 1px; width:160px; cursor:pointer; z-index:2;"data-koriste="kellokoriste.png">

        <!--9--> <img src="Lahjapaketti.png" alt="Lahjapaketti" class="lahjapaketti"
         style="position:absolute; left:63%; bottom: 1px; width:160px; cursor:pointer; z-index:1;"data-koriste="karkkikeppi.png">

        <!--10--> <img src="valkosini.png" alt="Lahjapaketti" class="lahjapaketti"
         style="position:absolute; left:58.8%; bottom: 1px; width:160px; cursor:pointer; z-index:2;"data-koriste="punaisetpallot.png">

        <!--11--> <img src="kelttu.png" alt="Lahjapaketti" class="lahjapaketti"
         style="position:absolute; left:54.6%; bottom: 1px; width:160px; cursor:pointer; z-index:2;"data-koriste="pipariukko.png">

        <!--12--> <img src="kelttu.png" alt="Lahjapaketti" class="lahjapaketti"
         style="position:absolute; left:50.4%; bottom: 1px; width:160px; cursor:pointer; z-index:2;"data-koriste="koristepallo1.png">

        <!--13--> <img src="valkosini.png" alt="Lahjapaketti" class="lahjapaketti"
         style="position:absolute; left:46.6%; bottom: 1px; width:160px; cursor:pointer; z-index:2;" data-koriste="karkkikeppi.png">

        <!--14--> <img src="Punasiniora.png" alt="Lahjapaketti" class="lahjapaketti"
         style="position:absolute; left:42%; bottom: 1px; width:160px; cursor:pointer; z-index:2;" data-koriste="kellokoriste.png">

        <!--15--> <img src="keltasini.png" alt="Lahjapaketti" class="lahjapaketti"
         style="position:absolute; left:37.8%; bottom: 1px; width:160px; cursor:pointer; z-index:2;" data-koriste="punaisetpallot.png">

        <!--16--> <img src="Lahjapaketti.png" alt="Lahjapaketti" class="lahjapaketti"
         style="position:absolute; left:33.6%; bottom: 1px; width:160px; cursor:pointer; z-index:2;"data-koriste="karkkikeppi.png">

        <!--17--> <img src="sinipuna.png" alt="Lahjapaketti" class="lahjapaketti"
         style="position:absolute; left: 29.4%; bottom: 1px; width:160px; cursor:pointer; z-index:2;"data-koriste="koristepallo1.png">

        <!--18--> <img src="Lahjapaketti.png" alt="Lahjapaketti" class="lahjapaketti"
         style="position:absolute; left:25.2%; bottom: 1px; width:160px; cursor:pointer; z-index:1;"data-koriste="punaisetpallot.png">

        <!--19--> <img src="valkosini.png" alt="Lahjapaketti" class="lahjapaketti"
         style="position:absolute; left:21%; bottom: 1px; width:160px; cursor:pointer; z-index:2;"data-koriste="karkkikeppi.png">

        <!--20--> <img src="kelttu.png" alt="Lahjapaketti" class="lahjapaketti"
         style="position:absolute; left:16.8%; bottom: 1px; width:160px; cursor:pointer; z-index:2;"data-koriste="karkkikeppi.png">

        <!--21--> <img src="kelttu.png" alt="Lahjapaketti" class="lahjapaketti"
         style="position:absolute; left:12.6%; bottom: 1px; width:160px; cursor:pointer; z-index:2;"data-koriste="karkkikeppi.png">

        <!--22--> <img src="valkosini.png" alt="Lahjapaketti" class="lahjapaketti"
         style="position:absolute; left:8.4%; bottom: 1px; width:160px; cursor:pointer; z-index:2;" data-koriste="karkkikeppi.png">

        <!--23--> <img src="Punasiniora.png" alt="Lahjapaketti" class="lahjapaketti"
         style="position:absolute; left:4.2%; bottom: 1px; width:160px; cursor:pointer; z-index:2;" data-koriste="karkkikeppi.png">

        <!--24--> <img src="keltasini.png" alt="Lahjapaketti" class="lahjapaketti"
         style="position:absolute; left:0%; bottom: 1px; width:160px; cursor:pointer; z-index:2;" data-koriste="karkkikeppi.png">
        </div> 

        <!-- 24 jälkeen tulis tähti ja valot???????-->


    </main>
<script>
    const canvas = document.getElementById('snow-canvas');
    const ctx = canvas.getContext('2d');

    let width = window.innerWidth;
    let height = window.innerHeight;

    canvas.width = width;
    canvas.height = height;

    // Päivitä canvas-koon kun ikkunan koko muuttuu
    window.addEventListener('resize', () => {
        width = window.innerWidth;
        height = window.innerHeight;
        canvas.width = width;
        canvas.height = height;
    });

    // Lumisateen säädöt
    const FLAKE_COUNT = 150;
    const SPEED_MIN = 0.5;
    const SPEED_MAX = 2;
    const SIZE_MIN = 1;
    const SIZE_MAX = 4;
    const WIND_STRENGTH = 0.5;

    const flakes = [];

    // Satunnaisluku väliltä [min, max)
    function random(min, max) {
        return Math.random() * (max - min) + min;
    }

    // Luodaan yksi hiutale
    function createFlake() {
        return {
            x: random(0, width),
            y: random(-height, 0),
            radius: random(SIZE_MIN, SIZE_MAX),
            speed: random(SPEED_MIN, SPEED_MAX),          // putoamisnopeus
            drift: random(-WIND_STRENGTH, WIND_STRENGTH), // sivuliike
            opacity: random(0.4, 1),
        };
    }

    // Luodaan kaikki hiutaleet
    function initFlakes() {
        for (let i = 0; i < FLAKE_COUNT; i++) {
            flakes.push(createFlake());
        }
    }

    // Piirretään ja liikutetaan hiutaleita
    function draw() {
        ctx.clearRect(0, 0, width, height);

        ctx.beginPath();

        for (const flake of flakes) {
            ctx.globalAlpha = flake.opacity;
            ctx.moveTo(flake.x, flake.y);
            ctx.arc(flake.x, flake.y, flake.radius, 0, Math.PI * 2);

            // päivitetään sijainti
            flake.y += flake.speed;
            flake.x += flake.drift + Math.sin(flake.y * 0.01) * 0.2;

            // jos tippuu alareunan ohi -> takaisin ylös
            if (flake.y > height + flake.radius) {
                flake.y = -flake.radius;
                flake.x = random(0, width);
            }

            // jos menee sivulta ohi -> toiselle puolelle
            if (flake.x > width + flake.radius) flake.x = -flake.radius;
            if (flake.x < -flake.radius) flake.x = width + flake.radius;
        }

        ctx.fillStyle = '#ffffff';
        ctx.fill();
        ctx.globalAlpha = 1;

        requestAnimationFrame(draw);
    }

    initFlakes();
    draw();

    const lahjapaketit = document.querySelectorAll(".lahjapaketti");
    const kuusiContainer = document.querySelector(".kuusi-container");

    const kuusi = document.querySelector('.kuusi');
    const tahti = document.querySelector('.tahti');
    const jouluvalot = document.querySelector('.jouluvalot');

function positionTahti() {
  if (!kuusi || !tahti) return;

  // Hae kuusen containerin ja kuusen sijainnit
  const containerRect = kuusiContainer.getBoundingClientRect();
  const kuusiRect = kuusi.getBoundingClientRect();

  // Tähden leveys suhteessa kuusen leveyteen
  const starW = Math.round(kuusiRect.width * 0.12);
  tahti.style.width = starW + 'px';

  // Laske kuusen keskikohta containerin sisällä
  const centerX = kuusiRect.left + kuusiRect.width / 2 - containerRect.left;
  const x = Math.round(centerX - starW / 2);

  // Laske kuusen yläreuna containerin sisällä
  const tipY = kuusiRect.top - containerRect.top;
  const y = Math.round(tipY - starW * 0.28); // hienosäätö: nosta hieman latvan yläpuolelle

  tahti.style.left = x + 'px';
  tahti.style.top = y + 'px';
}

// sijoita tähti kun kuusi latautuu tai ikkuna muuttuu
if (kuusi) {
  if (kuusi.complete) positionTahti();
  else kuusi.addEventListener('load', positionTahti);
}
window.addEventListener('resize', positionTahti);

    // yhden paketin avaus per päivä
    // const tanaan = new Date();
    // const paiva = tanaan.getDate();
    // const kuukausi = tanaan.getMonth() + 1;

    // let paivaAvattu = false;

  function tarkistaKaikkiAvattu() {
  const kaikkiPiilotettu = [...lahjapaketit].every(p => p.style.display === 'none');

  if (kaikkiPiilotettu && tahti) {
    positionTahti();                // sijoita tähti oikein
    tahti.classList.add('nakyva');  // näytä tähti

    if (jouluvalot) {
      jouluvalot.classList.add('nakyva'); // ✨ sytytä jouluvalot
    }
  }
}
    lahjapaketit.forEach(paketti => {
    paketti.addEventListener('click', () => {

    // sallitaan vain joulukuussa ja vain yksi avaus per päivä
    //if (kuukausi !== 12 || paivaAvattu) return;

    // piilota klikattu paketti
    paketti.style.display = 'none';

    // hae kuvan polku paketista
    const kuva = paketti.dataset.koriste;
    if (!kuva) return;

    // luo uusi koristekuva
    const uusiKoriste = document.createElement('img');
    uusiKoriste.src = kuva;
    uusiKoriste.alt = 'Koriste';
    uusiKoriste.style.position = 'absolute';
    uusiKoriste.style.left = '45%';
    uusiKoriste.style.top = '20%';
    uusiKoriste.style.width = '80px';
    uusiKoriste.style.cursor = 'grab';
    uusiKoriste.style.zIndex = '10';

    // paivaAvattu = true; // merkataan että päivän paketti on avattu

    // lisää kuusen containeriin
    kuusiContainer.appendChild(uusiKoriste);

    // raahaus tälle koristeelle
    let dragging = false;

    uusiKoriste.addEventListener('mousedown', () => {
      dragging = true;
      document.body.style.userSelect = 'none';
    });

    document.addEventListener('mousemove', (e) => {
      if (!dragging) return;
      const rect = kuusiContainer.getBoundingClientRect();
      const x = e.clientX - rect.left - (uusiKoriste.width / 2);
      const y = e.clientY - rect.top  - (uusiKoriste.height / 2);
      uusiKoriste.style.left = x + 'px';
      uusiKoriste.style.top  = y + 'px';
    });

    document.addEventListener('mouseup', () => {
      dragging = false;
      document.body.style.userSelect = '';
        tarkistaKaikkiAvattu();
    });
  });
});
 
 </script>

</body>

</html>