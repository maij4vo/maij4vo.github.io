<!DOCTYPE html>
<html lang = 'fi'>

<head>
    <meta charset = 'UTF-8' />
    <meta name ='viewport' content = 'width = device-width, initial-scale=1' />
    <title>Joulukalenteri</title>
    <link rel = 'stylesheet' href = 'tyyli.css'>
</head>

<body>
    <canvas id = 'snow-canvas'></canvas>
    <header>
    <h1> Joulukalenteri 2025 </h1>
    </header>

    <main>

    <!-- Tänne joulukuusi (Lisäsin lahjapaketin kuusen juureen) --> 
    <div class = 'kuusi-container'>
        <img src = 'kuusi.png' alt = 'joulukuusi' class = 'kuusi' />
         <img src="lahjapaketti.png" alt="Lahjapaketti" id="lahjapaketti"
         style="position:absolute; left:59%; bottom: 1px; width:160px; cursor:pointer; z-index:2;">
    </div> 

     <!-- lahjapaketti-kuvan jälkeen: -->
<img src="karkkikeppi.png" alt="Koriste" id="uusi-koriste" style="position:absolute; top:60%; left:40%; display:none; cursor:grab; width:80px;">

    <!--Tänne kaikki 24kpl koristeita-->
    <div class = 'koristeet'> <!-- yhteinen ryhmä koristeille, jonka sisässä on jokaiselle oma ryhmä-->
        <div class = 'koriste1'>
        </div>  

        <div class = 'koriste2'>
        </div>

        <div class = 'koriste3'>
        </div>

        <div class = 'koriste4'>
        </div>

        <div class = 'koriste5'>
        </div>

        <div class = 'koriste6'>
        </div>

        <div class = 'koriste7'>
        </div>

        <div class = 'koriste8'>
        </div>

        <div class = 'koriste9'>
        </div>

        <div class = 'koriste10'>
        </div>

        <div class = 'koriste11'>
        </div>

        <div class = 'koriste12'>
        </div>

        <div class = 'koriste13'>
        </div>

        <div class = 'koriste14'>
        </div>

        <div class = 'koriste15'>
        </div>

        <div class = 'koriste16'>
        </div>

        <div class = 'koriste17'>
        </div>

        <div class = 'koriste18'>
        </div>

        <div class = 'koriste19'>
        </div>

        <div class = 'koriste20'>
        </div>

        <div class = 'koriste21'>
        </div>

        <div class = 'koriste22'>
        </div>

        <div class = 'koriste23'>
        </div>

        <div class = 'koriste24'>
        </div>
        
    </div>

    </main>
<script>
    const canvas = document.getElementById('snow-canvas');
    const ctx = canvas.getContext('2d');

    let width = window.innerWidth;
    let height = window.innerHeight;

    canvas.width = width;
    canvas.height = height;

    // Päivitä canvas-koon kun ikkunan koko muuttuu
    window.addEventListener('resize', () => {
        width = window.innerWidth;
        height = window.innerHeight;
        canvas.width = width;
        canvas.height = height;
    });

    // Lumisateen säädöt
    const FLAKE_COUNT = 150;
    const SPEED_MIN = 0.5;
    const SPEED_MAX = 2;
    const SIZE_MIN = 1;
    const SIZE_MAX = 4;
    const WIND_STRENGTH = 0.5;

    const flakes = [];

    // Satunnaisluku väliltä [min, max)
    function random(min, max) {
        return Math.random() * (max - min) + min;
    }

    // Luodaan yksi hiutale
    function createFlake() {
        return {
            x: random(0, width),
            y: random(-height, 0),
            radius: random(SIZE_MIN, SIZE_MAX),
            speed: random(SPEED_MIN, SPEED_MAX),          // putoamisnopeus
            drift: random(-WIND_STRENGTH, WIND_STRENGTH), // sivuliike
            opacity: random(0.4, 1),
        };
    }

    // Luodaan kaikki hiutaleet
    function initFlakes() {
        for (let i = 0; i < FLAKE_COUNT; i++) {
            flakes.push(createFlake());
        }
    }

    // Piirretään ja liikutetaan hiutaleita
    function draw() {
        ctx.clearRect(0, 0, width, height);

        ctx.beginPath();

        for (const flake of flakes) {
            ctx.globalAlpha = flake.opacity;
            ctx.moveTo(flake.x, flake.y);
            ctx.arc(flake.x, flake.y, flake.radius, 0, Math.PI * 2);

            // päivitetään sijainti
            flake.y += flake.speed;
            flake.x += flake.drift + Math.sin(flake.y * 0.01) * 0.2;

            // jos tippuu alareunan ohi -> takaisin ylös
            if (flake.y > height + flake.radius) {
                flake.y = -flake.radius;
                flake.x = random(0, width);
            }

            // jos menee sivulta ohi -> toiselle puolelle
            if (flake.x > width + flake.radius) flake.x = -flake.radius;
            if (flake.x < -flake.radius) flake.x = width + flake.radius;
        }

        ctx.fillStyle = '#ffffff';
        ctx.fill();
        ctx.globalAlpha = 1;

        requestAnimationFrame(draw);
    }

    initFlakes();
    draw();

const lahjapaketti = document.getElementById('lahjapaketti');
const koriste = document.getElementById('uusi-koriste');
const kuusiContainer = document.querySelector('.kuusi-container');

lahjapaketti.addEventListener('click', () => {
    koriste.style.display = 'block';
    // koristeen lähtöpaikka kuusen päällä
    koriste.style.left = '45%';
    koriste.style.top = '20%';
});

let isDragging = false;

koriste.addEventListener('mousedown', (e) => {
    isDragging = true;
    document.body.style.userSelect = 'none';
});

document.addEventListener('mousemove', (e) => {
    if (!isDragging) return;
    // suhteutetaan kuusen containerin sijaintiin!
    const rect = kuusiContainer.getBoundingClientRect();
    const x = e.clientX - rect.left - koriste.width / 2;
    const y = e.clientY - rect.top - koriste.height / 2;
    koriste.style.left = x + 'px';
    koriste.style.top = y + 'px';
});

document.addEventListener('mouseup', () => {
    isDragging = false;
    document.body.style.userSelect = '';
    // koriste jää siihen mihin sen raahaat kuusen päällä
});

 </script>

</body>

</html>